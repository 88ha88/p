<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>νμΌ μ•”νΈν™”/λ³µνΈν™”</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      padding: 30px;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input, select, button {
      width: 100%;
      margin-top: 10px;
      padding: 10px;
      font-size: 16px;
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    .section {
      margin-bottom: 30px;
    }
    .label {
      margin-top: 15px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>π” νμΌ μ•”νΈν™”/λ³µνΈν™”</h2>

    <div class="section">
      <h3>RSA ν‚¤ μƒμ„±</h3>
      <input type="text" id="rsaUserId" placeholder="μ‚¬μ©μ ID">
      <button onclick="generateRSA()">RSA ν‚¤ μƒμ„±</button>
    </div>

    <div class="section">
      <h3>μ•”νΈν™”</h3>
      <input type="file" id="encryptFile">
      <input type="text" id="encryptUserId" placeholder="μ‚¬μ©μ ID">
      <input type="file" id="publicKey">
      <input type="text" id="newExt" placeholder="μƒ ν™•μ¥μ (μ: .dat)">
      <button onclick="encryptFile()">νμΌ μ•”νΈν™”</button>
    </div>

    <div class="section">
      <h3>λ³µνΈν™”</h3>
      <input type="file" id="decryptFile">
      <input type="text" id="decryptUserId" placeholder="μ‚¬μ©μ ID">
      <input type="file" id="privateKey">
      <button onclick="decryptFile()">νμΌ λ³µνΈν™”</button>
    </div>

    <div id="result"></div>
  </div>

  <script>
    function showResult(message) {
      document.getElementById('result').innerText = message;
    }

    function generateRSA() {
      const userId = document.getElementById("rsaUserId").value;
      if (!userId) return alert("μ‚¬μ©μ IDλ¥Ό μ…λ ¥ν•΄μ£Όμ„Έμ”.");
      fetch("/generate_rsa", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ user_id: userId })
      }).then(res => res.text()).then(showResult);
    }

    function encryptFile() {
      const formData = new FormData();
      const file = document.getElementById("encryptFile").files[0];
      const pubKey = document.getElementById("publicKey").files[0];
      const userId = document.getElementById("encryptUserId").value;
      const newExt = document.getElementById("newExt").value;

      if (!file || !pubKey || !userId) return alert("λ¨λ“  μ…λ ¥κ°’μ„ μ±„μ›μ£Όμ„Έμ”.");

      formData.append("file", file);
      formData.append("public_key", pubKey);
      formData.append("user_id", userId);
      formData.append("new_ext", newExt);

      fetch("/encrypt", {
        method: "POST",
        body: formData
      }).then(res => res.text()).then(showResult);
    }

    function decryptFile() {
      const formData = new FormData();
      const file = document.getElementById("decryptFile").files[0];
      const priKey = document.getElementById("privateKey").files[0];
      const userId = document.getElementById("decryptUserId").value;

      if (!file || !priKey || !userId) return alert("λ¨λ“  μ…λ ¥κ°’μ„ μ±„μ›μ£Όμ„Έμ”.");

      formData.append("file", file);
      formData.append("private_key", priKey);
      formData.append("user_id", userId);

      fetch("/decrypt", {
        method: "POST",
        body: formData
      }).then(res => res.text()).then(showResult);
    }
  </script>
</body>
</html>
